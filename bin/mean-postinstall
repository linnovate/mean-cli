var fs = require ('fs'),
    chalk = require ('chalk'),
    spawn = require('child_process').spawn,
    npm = require(process.cwd() + '/node_modules/meanio/node_modules/npm');


    console.log("Auto installing packages");

    npm.load(function(err, npm) {
        var source = 'packages'
        fs.readdir(process.cwd() + '/' + source, function(err, files) {
            if (err || !files || !files.length) {
                if (err && err.code !== 'ENOENT') console.log(err);
                return callback();
            }

            var packages = [];
            files.forEach(function(file, index) {
                packages.push(process.cwd() + '/packages/' + file);
            });

            npm.commands.install(packages, function(err) {
                if (err) {
                    console.log(err);
                    console.log(chalk.red('Error: npm install failed'));
                }
                else {
                    console.log(chalk.green('Success: npm install succeeded'));
                }
            });


            // install bower
            console.log('Installing Bower packages async');
            node  = spawn('node', ['node_modules/bower/bin/bower install --config.interactive=false']);
            node.stdin.end();
        });
    });
